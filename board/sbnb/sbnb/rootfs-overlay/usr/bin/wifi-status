#!/bin/sh
# Show WiFi connection status
# Usage: wifi-status [INTERFACE]

# Find first wireless interface if none specified
find_wireless_iface() {
    for dev in /sys/class/net/*/wireless; do
        [ -d "$dev" ] && basename "$(dirname "$dev")" && return
    done
    echo ""
}

IFACE="${1:-$(find_wireless_iface)}"

echo "=== WiFi Status ==="
echo ""

# List all wireless interfaces
echo "Wireless interfaces:"
iw dev 2>/dev/null | grep -E "Interface|ssid|channel|txpower" | sed 's/^/  /'
echo ""

# Check if interface was found/exists
if [ -z "$IFACE" ] || ! ip link show "$IFACE" >/dev/null 2>&1; then
    echo "No wireless interface found"
    exit 1
fi

# Show connection status
echo "Connection status ($IFACE):"
iw dev "$IFACE" link 2>/dev/null | sed 's/^/  /'
echo ""

# Show IP address
echo "IP address:"
ip -4 addr show "$IFACE" 2>/dev/null | grep inet | awk '{print "  " $2}'
echo ""

# Show wpa_supplicant service status
echo "Service status:"
systemctl is-active "wpa_supplicant@${IFACE}" 2>/dev/null && \
    echo "  wpa_supplicant@${IFACE}: active" || \
    echo "  wpa_supplicant@${IFACE}: inactive"
